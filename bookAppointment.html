
<html>
    <body>
        <form onsubmit="saveToLocalStorage(event)">
        
            <label>Name :</label>
            <input id="username"  type="text" name="username" required/>

            <label> EmailId :</label>
            <input id="email" type="email" name="emailId" required/>

            <label>Phone Number :</label>
            <input id="phonenumber" type="tel" name="phonenumber" />

            <button> Submit </button>

        </form>

        <ul id = 'listOfitems'></ul>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>

        <script>
            function saveToLocalStorage(event) {
                event.preventDefault();

                const name = event.target.username.value;
                const email = event.target.emailId.value;
                const phonenumber = event.target.phonenumber.value;

                // localStorage.setItem('name', name);
                // localStorage.setItem('email', email);
                // localStorage.setItem('phonenumber', phonenumber);
                
                const obj = {
                    name,
                    email,
                    phonenumber
                }

                axios.post("https://crudcrud.com/api/017a7e3cc6184573a2df160805092718/appointmentData",obj)
                .then((response) => {
                    showUserOnScreen(response.data)
                    // console.log(response)
                })

                .catch((err) => {
                    document.body.innerHTML=document.body.innerHTML + "<h4> Somthing went wrong </h4>"
                    console.log(err)
                })
                // localStorage.setItem(obj.email, JSON.stringify(obj))
                // showUserOnScreen(obj)
            }

            window.addEventListener("DOMContentLoaded", () => {
                axios.get("https://crudcrud.com/api/017a7e3cc6184573a2df160805092718/appointmentData")
                .then((response) => {
                    // console.log(response)
showUserOnScreen(response.data)
                    // for(var i=0; i<response.data; i++){
                    //     showUserOnScreen(response.data[i])
                    // }
                })
                .catch((error) => {
                    console.log(error)
                })

                // console.log(data)
                // const localStorageObj = localStorage;
                // const localStoragekeys = Object.keys(localStorageObj)

                // for(var i=0; i<localStoragekeys.length; i++){
                //     const key = localStoragekeys[i]
                //     const userDetailsString = localStorageObj[key];
                //     const userDetailsObj = JSON.parse(userDetailsString);
                //     showUserOnScreen(userDetailsObj)
                // }
            })

            function showUserOnScreen(user){
            //     const parentELem = document.getElementById('listOfitems')
                
            //     const childElem = document.createElement('li')
            //     childElem.textContent = obj.name + '-' + obj.email + '-' + obj.phonenumber
        
            //     const deleteButton = document.createElement('input')
               
            // //    Make it button
            //     deleteButton.type = "button"  
            //     deleteButton.value = "Delete" 
            //     deleteButton.onclick = () => {
            //         localStorage.removeItem(obj.email)
            //         parentELem.removeChild(childElem)
              

            document.getElementById('email').value = '';
            document.getElementById('username').value = '';
            document.getElementById('phonenumber').value = '';

            if(localStorage.getItem(user.email) !== null) {
               removeUserFromScreen(user.email)
            }

            const parentNode = document.getElementById('listOfUsers');
            const childHTML = `<li id=${user._id}> ${user.name} - ${user.email}
                <button onclick = deleteUser('${user._id}')> Delete User
                    <button onclick = EditUserDetails('${user._id}','${user.name}')
                    </li>`

                    parentNode.innerHTML = parentNode.innerHTML + childHTML;
            }
        

            // const editButton = document.createElement('input')
            // editButton.type = "button"
            // editButton.value = 'Edit'
            // editButton.onclick = () => {
            //     localStorage.removeItem(obj.email)
            //     parentELem.removeChild(childElem)
            //     document.getElementsByTagName('usernameInputTag').value = obj.name
            //     document.getElementsByTagName('emailInputTag').value = obj.email
            //     document.getElementsByTagName('phoneNumberInputTag').value = obj.phonenumber
            // }

            // childElem.appendChild(deleteButton)
            // childElem.appendChild(editButton)
            // parentELem.appendChild(childElem)


            const parentElem = document.getElementById('listOfitems')
    
    const childElem = document.createElement('li')
    childElem.textContent = user.name + '-' + user.email + '-' + user.phonenumber

    const deleteButton = document.createElement('input')
    deleteButton.type = "button"  
    deleteButton.value = "Delete" 
    deleteButton.onclick = () => {
        axios.delete("https://crudcrud.com/api/e2ff6429002e4408a22f39e768363e8a/appointmentdata/" + user._id)
        .then(() => {
            removeUserFromScreen(user.email)
        })
        .catch((err) => {
            document.body.innerHTML=document.body.innerHTML + "<h4> Somthing went wrong </h4>"
            console.log(err)
        })
    }

    const editButton = document.createElement('input')
    editButton.type = "button"
    editButton.value = 'Edit'
    editButton.onclick = () => {
        editUserDetails(user.email,user.name,user.phonenumber)
    }

    childElem.appendChild(deleteButton)
    childElem.appendChild(editButton)
    parentElem.appendChild(childElem)


            function editUserDetails(email,n,p){
                document.getElementById('email').value = emailId;
                document.getElementById('username').value = n;
                document.getElementById('phonenumber').value = p;
                deleteUser(emailId);
            }

            // editUserDetails('email')
            function deleteUser(userId){ //storage is passed as a variable
                
                axios.delete(`https://crudcrud.com/api/017a7e3cc6184573a2df160805092718/appointmentData/${userId}`)
                .then((response) => {
                    removeUserFromScreen(userId)
                })

                .catch((error) => {
                    console.log(error);
                })


                // console.log(emailId)
                // localStorage.removeItem(emailId); // this will remove from local storage
                // removeUserFromScreen(emailId);
            }

            function removeUserFromScreen(userId){
                const parentNode = document.getElementById('listOfitems');
                const childNodetobeRemoved = document.getElementById(userId);
                if (childNodetobeRemoved) {
                parentNode.removeChild(childNodetobeRemoved);
                }
            }
        
        
        
        </script>
    </body>
</html>